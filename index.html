<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>macOS Desktop Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            height: 100vh;
        }

        .desktop {
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #4f8cff 0%, #1e2746 100%);
            position: relative;
            overflow: hidden;
        }

        /* Menu Bar */
        .menu-bar {
            height: 24px;
            background: rgba(60, 150, 210, 0.85);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            color: #fff;
            font-size: 14px;
            font-weight: 400;
            text-shadow: 0 1px 2px rgba(0,0,0,0.18);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .menu-left, .menu-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-item {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 400;
            transition: background 0.2s;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .apple-logo {
            margin-right: 4px;
            position: relative;
        }

        .apple-icon {
            height: 18px;
            width: 18px;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.18));
        }

        .menu-item.finder,
        .menu-item.active {
            font-weight: 600;
        }

        /* Desktop Icons */
        .desktop-icons {
            position: absolute;
            top: 40px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.2s;
            max-width: 80px;
            text-align: center;
        }

        .desktop-icon:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .icon {
            font-size: 48px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .icon-label {
            font-size: 11px;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            word-wrap: break-word;
        }

        /* Terminal Window */
        .terminal-window {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            height: 500px;
            background: #1e1e1e;
            border-radius: 10px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            z-index: 100;
            min-width: 350px;
            min-height: 200px;
        }

        .terminal-window.resizing-n { cursor: n-resize !important; }
        .terminal-window.resizing-s { cursor: s-resize !important; }
        .terminal-window.resizing-e { cursor: e-resize !important; }
        .terminal-window.resizing-w { cursor: w-resize !important; }
        .terminal-window.resizing-ne { cursor: ne-resize !important; }
        .terminal-window.resizing-nw { cursor: nw-resize !important; }
        .terminal-window.resizing-se { cursor: se-resize !important; }
        .terminal-window.resizing-sw { cursor: sw-resize !important; }

        .terminal-header {
            height: 32px;
            background: #2d2d2d;
            display: flex;
            align-items: center;
            padding: 0 12px;
            border-bottom: 1px solid #404040;
        }

        .terminal-buttons {
            display: flex;
            gap: 8px;
            margin-right: 15px;
        }

        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .terminal-button.close {
            background: #ff5f56;
        }

        .terminal-button.minimize {
            background: #ffbd2e;
        }

        .terminal-button.maximize {
            background: #27ca3f;
        }

        .terminal-button:hover {
            opacity: 0.8;
        }

        .terminal-title {
            color: #b4b4b4;
            font-size: 12px;
            font-weight: 500;
        }

        .terminal-body {
            height: calc(100% - 32px);
            padding: 15px;
            background: #1e1e1e;
        }

        .terminal-content {
            height: 100%;
            overflow-y: auto;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            color: #f8f8f2;
        }

        .terminal-line {
            display: flex;
            margin-bottom: 5px;
        }

        .prompt {
            color: #a6e22e;
            margin-right: 10px;
            white-space: nowrap;
        }

        .command-input {
            color: #f8f8f2;
            outline: none;
            flex: 1;
            min-width: 0;
        }

        .command-output {
            color: #f8f8f2;
            margin-left: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .command-error {
            color: #f92672;
            margin-left: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .command-welcome {
            color: #66d9ef;
            margin-left: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Dock */
        .dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            padding: 8px 16px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .dock-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            padding: 8px 4px;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .dock-item:hover {
            transform: scale(1.2);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .dock-item.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .dock-icon {
            width: 48px;
            height: 48px;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .dock-label {
            font-size: 10px;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: absolute;
            bottom: -20px;
            white-space: nowrap;
        }

        .dock-item:hover .dock-label {
            opacity: 1;
            transform: translateY(0);
        }

        /* Scrollbar styling */
        .terminal-content::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-content::-webkit-scrollbar-track {
            background: #2d2d2d;
        }

        .terminal-content::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        .terminal-content::-webkit-scrollbar-thumb:hover {
            background: #777;
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .terminal-window {
                width: 90vw;
                height: 60vh;
            }
            
            .dock {
                gap: 4px;
                padding: 6px 12px;
            }
            
            .dock-icon {
                font-size: 24px;
            }
        }

        @media (max-width: 768px) {
            .desktop-icons {
                display: none;
            }
            
            .terminal-window {
                width: 95vw;
                height: 70vh;
            }
            
            .dock {
                gap: 2px;
                padding: 4px 8px;
            }
            
            .dock-icon {
                font-size: 20px;
            }
        }

        /* Dropdown Finder Menu */
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 32px;
            left: 0;
            min-width: 320px;
            background: rgba(30, 32, 36, 0.98);
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            color: #fff;
            font-size: 16px;
            padding: 8px 0;
            z-index: 2000;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .dropdown-section {
            border-top: 1px solid rgba(255,255,255,0.08);
            margin-top: 4px;
            padding-top: 4px;
        }
        .dropdown-section:first-child {
            border-top: none;
            margin-top: 0;
            padding-top: 0;
        }
        .dropdown-item {
            padding: 6px 24px;
            cursor: pointer;
            transition: background 0.18s;
            white-space: nowrap;
        }
        .dropdown-item:hover:not(.disabled):not(.color-dot) {
            background: rgba(80, 120, 255, 0.18);
        }
        .dropdown-item.disabled {
            color: #888;
            cursor: default;
        }
        .dropdown-item.color-dot {
            display: inline-block;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            margin: 0 4px;
            vertical-align: middle;
            border: 1.5px solid #222;
            cursor: pointer;
            padding: 0;
        }
        .dropdown-section.colors {
            padding-left: 20px;
            padding-bottom: 4px;
        }
        /* Show dropdown when active */
        .menu-item.finder.open #finderDropdown {
            display: block;
        }
        .menu-item.finder {
            position: relative;
        }

        .menu-right {
            display: flex;
            align-items: center;
            gap: 14px;
            font-size: 14px;
            color: #fff;
        }
        .status-icon {
            width: 16px;
            height: 16px;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.18));
            opacity: 0.92;
        }
        .status-dot {
            width: 6px;
            height: 6px;
            background: #7d5fff;
            border-radius: 50%;
            display: inline-block;
            margin-right: 4px;
        }
        .menu-date {
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0.5px;
            font-family: inherit;
        }
        .apple-dropdown-menu {
            display: none;
            position: absolute;
            top: 24px;
            left: 0;
            min-width: 260px;
            background: rgba(30, 32, 36, 0.98);
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            color: #fff;
            font-size: 15px;
            padding: 8px 0;
            z-index: 3000;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .apple-logo.open .apple-dropdown-menu {
            display: block;
        }
        .apple-dropdown-menu .dropdown-item {
            padding: 6px 24px;
            cursor: pointer;
            transition: background 0.18s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .apple-dropdown-menu .dropdown-item:hover {
            background: rgba(80, 120, 255, 0.18);
        }
        .apple-dropdown-menu .dropdown-divider {
            height: 1px;
            background: rgba(255,255,255,0.08);
            margin: 4px 0;
        }
        .badge {
            background: #444;
            color: #fff;
            font-size: 11px;
            border-radius: 10px;
            padding: 2px 8px;
            margin-left: 8px;
            font-weight: 600;
            display: inline-block;
        }
        #appWindows {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 200;
        }
        .app-window {
            position: absolute;
            top: 120px;
            left: 120px;
            width: 400px;
            min-width: 220px;
            min-height: 120px;
            background: #23272e;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            overflow: hidden;
            z-index: 201;
            pointer-events: auto;
            display: flex;
            flex-direction: column;
        }
        .app-window-header {
            height: 32px;
            background: #2d2d2d;
            display: flex;
            align-items: center;
            padding: 0 12px;
            border-bottom: 1px solid #404040;
            cursor: move;
            user-select: none;
        }
        .app-window-title {
            color: #fff;
            font-size: 15px;
            font-weight: 500;
            flex: 1;
        }
        .app-window-close {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #ff5f56;
            margin-left: 8px;
            cursor: pointer;
            border: none;
        }
        .app-window-content {
            flex: 1;
            background: #23272e;
            color: #fff;
            padding: 18px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- Desktop Background -->
    <div class="desktop">
        <!-- Menu Bar -->
        <div class="menu-bar">
            <div class="menu-left">
                <div class="apple-logo" id="appleMenuBtn">
                    <img src="icons/apple.svg" alt="Apple" class="apple-icon">
                    <div class="apple-dropdown-menu" id="appleDropdown">
                        <div class="dropdown-item">About This Mac</div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item">System Settings… <span class="badge">1 update</span></div>
                        <div class="dropdown-item">Location &rsaquo;</div>
                        <div class="dropdown-item">App Store</div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item">Recent Items &rsaquo;</div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item">Force Quit Opera</div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item">Sleep</div>
                        <div class="dropdown-item" id="restartMenu">Restart…</div>
                        <div class="dropdown-item">Shut Down…</div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item">Lock Screen</div>
                        <div class="dropdown-item">Log Out Stable Desktop…</div>
                    </div>
                </div>
                <div class="menu-item finder active" id="finderMenuBtn">Finder
                  <div class="dropdown-menu" id="finderDropdown">
                    <div class="dropdown-section">
                      <div class="dropdown-item">New Finder Window</div>
                      <div class="dropdown-item">New Folder</div>
                      <div class="dropdown-item">New Folder with Selection (2 Items)</div>
                      <div class="dropdown-item">New Smart Folder</div>
                      <div class="dropdown-item">New Tab</div>
                      <div class="dropdown-item">Open</div>
                      <div class="dropdown-item">Open With &rsaquo;</div>
                      <div class="dropdown-item">Close Window</div>
                    </div>
                    <div class="dropdown-section">
                      <div class="dropdown-item">Get Info</div>
                      <div class="dropdown-item">Rename...</div>
                      <div class="dropdown-item">Compress</div>
                      <div class="dropdown-item">Duplicate</div>
                      <div class="dropdown-item">Make Alias</div>
                      <div class="dropdown-item">Quick Look</div>
                      <div class="dropdown-item">Print</div>
                    </div>
                    <div class="dropdown-section">
                      <div class="dropdown-item">Share...</div>
                      <div class="dropdown-item disabled">Show Original</div>
                      <div class="dropdown-item">Add to Dock</div>
                      <div class="dropdown-item">Move to Trash</div>
                      <div class="dropdown-item">Eject</div>
                    </div>
                    <div class="dropdown-section colors">
                      <div class="dropdown-item color-dot" style="background:#ff3b30"></div>
                      <div class="dropdown-item color-dot" style="background:#ffcc00"></div>
                      <div class="dropdown-item color-dot" style="background:#4cd964"></div>
                      <div class="dropdown-item color-dot" style="background:#007aff"></div>
                      <div class="dropdown-item color-dot" style="background:#5856d6"></div>
                      <div class="dropdown-item color-dot" style="background:#ff2d55"></div>
                      <div class="dropdown-item color-dot" style="background:#8e8e93"></div>
                    </div>
                    <div class="dropdown-section">
                      <div class="dropdown-item">Tags...</div>
                    </div>
                    <div class="dropdown-section">
                      <div class="dropdown-item">Find</div>
                    </div>
                  </div>
                </div>
                <div class="menu-item">File</div>
                <div class="menu-item">Edit</div>
                <div class="menu-item">View</div>
                <div class="menu-item">Go</div>
                <div class="menu-item">Window</div>
                <div class="menu-item">Help</div>
            </div>
            <div class="menu-right">
                <img src="icons/battery.svg" class="status-icon" alt="Battery">
                <img src="icons/network.svg" class="status-icon" alt="Network">
                <img src="icons/search.svg" class="status-icon" alt="Search">
                <img src="icons/control-center.svg" class="status-icon" alt="Control Center">
                <span class="status-dot"></span>
                <span class="menu-date" id="menuDate"></span>
            </div>
        </div>

        <!-- Terminal Window -->
        <div class="terminal-window" id="terminalWindow">
            <div class="terminal-header">
                <div class="terminal-buttons">
                    <div class="terminal-button close"></div>
                    <div class="terminal-button minimize"></div>
                    <div class="terminal-button maximize"></div>
                </div>
                <div class="terminal-title">Terminal — zsh — 80×24</div>
            </div>
            <div class="terminal-body">
                <div class="terminal-content" id="terminalContent">
                    <!-- Initial prompt removed; handled by JS -->
                </div>
            </div>
        </div>

        <!-- Dock -->
        <div class="dock">
            <div class="dock-item active">
                <img class="dock-icon" src="icons/finder.png" alt="Finder">
                <div class="dock-label">Finder</div>
            </div>
            <div class="dock-item">
                <img class="dock-icon" src="icons/github.png" alt="GitHub">
                <div class="dock-label">GitHub</div>
            </div>
            <div class="dock-item">
                <img class="dock-icon" src="icons/opera.png" alt="Opera">
                <div class="dock-label">Opera</div>
            </div>
            <div class="dock-item">
                <img class="dock-icon" src="icons/preview.png" alt="Preview">
                <div class="dock-label">Preview</div>
            </div>
            <div class="dock-item">
                <img class="dock-icon" src="icons/safari.png" alt="Safari">
                <div class="dock-label">Safari</div>
            </div>
            <div class="dock-item">
                <img class="dock-icon" src="icons/terminal.png" alt="Terminal">
                <div class="dock-label">Terminal</div>
            </div>
            <div class="dock-item">
                <img class="dock-icon" src="icons/obsidian.png" alt="Obsidian">
                <div class="dock-label">Obsidian</div>
            </div>
            <div class="dock-item">
                <img class="dock-icon" src="icons/messages.png" alt="Messages">
                <div class="dock-label">Messages</div>
            </div>
            <div class="dock-item">
                <img class="dock-icon" src="icons/spark.png" alt="Spark">
                <div class="dock-label">Spark</div>
            </div>
            <div class="dock-item">
                <img class="dock-icon" src="icons/notes.png" alt="Notes">
                <div class="dock-label">Notes</div>
            </div>
        </div>

        <!-- App Windows Container -->
        <div id="appWindows"></div>
    </div>

    <script>
        class Terminal {
            constructor() {
                this.terminalContent = document.getElementById('terminalContent');
                this.commandHistory = [];
                this.historyIndex = -1;
                this.currentDirectory = '~';
                this.fileSystem = this.createFileSystem();
                
                this.init();
            }

            createFileSystem() {
                return {
                    '~': {
                        type: 'directory',
                        contents: {
                            'Documents': { type: 'directory', contents: {} },
                            'Downloads': { type: 'directory', contents: {} },
                            'Desktop': { type: 'directory', contents: {} },
                            'readme.txt': { type: 'file', content: 'Welcome to the macOS Terminal Simulator!\n\nThis is a client-side only application that simulates a terminal environment.\n\nType "help" to see available commands.' },
                            'hello.js': { type: 'file', content: 'console.log("Hello, World!");\n\n// This is a sample JavaScript file\nfunction greet(name) {\n    return `Hello, ${name}!`;\n}\n\ngreet("macOS");' }
                        }
                    }
                };
            }

            init() {
                this.createNewLine();
            }

            updatePrompt() {
                return `stabledesktop@macbookpro-user ${this.currentDirectory} %`;
            }

            handleKeyDown(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    this.executeCommand();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    this.navigateHistory('up');
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    this.navigateHistory('down');
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    this.handleTabCompletion();
                }
            }

            handleInput(e) {
                // Prevent line breaks
                if (e.target.textContent.includes('\n')) {
                    e.target.textContent = e.target.textContent.replace(/\n/g, '');
                }
            }

            async executeCommand() {
                const command = this.commandInput.textContent.trim();
                
                if (!command) {
                    this.createNewLine();
                    return;
                }

                // Add to history
                this.commandHistory.push(command);
                this.historyIndex = this.commandHistory.length;

                // Display command
                this.print(`\n${this.updatePrompt()} ${command}`, 'command');

                // Handle built-in commands
                if (this.handleBuiltInCommands(command)) {
                    this.createNewLine();
                    return;
                }

                // Handle file system commands
                if (this.handleFileSystemCommands(command)) {
                    this.createNewLine();
                    return;
                }

                // Unknown command
                this.print(`zsh: command not found: ${command}`, 'error');
                this.createNewLine();
            }

            handleBuiltInCommands(command) {
                const cmd = command.toLowerCase().trim();
                
                switch (cmd) {
                    case 'help':
                        this.print(`
Available commands:
  help                    - Show this help message
  clear                   - Clear the terminal
  stabledesktop --create  - Create a new Stable Desktop project
  stabledesktop --agent   - Start a Stable Desktop agent
`, 'output');
                        return true;

                    case 'clear':
                        this.clear();
                        return true;

                    case 'date':
                        this.print(new Date().toString(), 'output');
                        return true;

                    case 'whoami':
                        this.print('user', 'output');
                        return true;

                    case 'pwd':
                        this.print(this.currentDirectory, 'output');
                        return true;

                    case 'history':
                        this.print(this.commandHistory.join('\n'), 'output');
                        return true;

                    case 'exit':
                        window.location.reload();
                        return true;

                    case 'neofetch':
                        this.print(`
                    .:okOOOkdc'           'cdkOOOko:.                    user@macbook-pro
                .xOOOOOOOOOOOOc       cOOOOOOOOOOOOx.                ---------------
              ,OOOOOOOOOOOOOOOk,   ,kOOOOOOOOOOOOOOO,               OS: macOS Simulator
             'OOOOOOOOOOOOOOOOO: :OOOOOOOOOOOOOOOOO'                Kernel: Browser-based
            .OOOOOOOOOOOOOOOOOOkOOOOOOOOOOOOOOOOO.                  Uptime: ${Math.floor(Math.random() * 24)}h ${Math.floor(Math.random() * 60)}m
            :OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO:                  Shell: zsh
            'OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO'                  CPU: JavaScript Engine
            .OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO.                  Memory: ${Math.floor(Math.random() * 8 + 4)}GB
             cOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOc                    Disk: Virtual
              :OOOOOOOOOOOOOOOOOOOOOOOOOOOOOO:                     
               .:oooooooooooooooooooooooooo:.                      
                   .:oooooooooooooooooo:.                          
                       .:oooooooooo:.                              
                           .:oooo:.                                 
                             .:o:.                                 
`, 'output');
                        return true;

                    case 'stabledesktop --create':
                        this.print('Stable Desktop project created successfully!', 'output');
                        return true;

                    case 'stabledesktop --agent':
                        this.print('Stable Desktop agent started!', 'output');
                        return true;

                    case 'open app':
                        createAppWindow('Sample App', 'This is a sample desktop app window.');
                        this.print('App window created!', 'output');
                        return true;

                    default:
                        if (cmd.startsWith('echo ')) {
                            this.print(command.substring(5), 'output');
                            return true;
                        }
                        return false;
                }
            }

            handleFileSystemCommands(command) {
                const parts = command.split(' ');
                const cmd = parts[0].toLowerCase();
                
                switch (cmd) {
                    case 'ls':
                        this.listDirectory(parts.slice(1));
                        return true;
                    case 'cd':
                        this.changeDirectory(parts.slice(1));
                        return true;
                    case 'cat':
                        this.catFile(parts.slice(1));
                        return true;
                    case 'mkdir':
                        this.makeDirectory(parts.slice(1));
                        return true;
                    case 'touch':
                        this.touchFile(parts.slice(1));
                        return true;
                    case 'rm':
                        this.removeFile(parts.slice(1));
                        return true;
                    default:
                        return false;
                }
            }

            listDirectory(args) {
                const path = this.currentDirectory;
                const dir = this.getDirectory(path);
                
                if (!dir) {
                    this.print(`ls: ${path}: No such file or directory`, 'error');
                    return;
                }

                const items = Object.keys(dir.contents);
                if (items.length === 0) {
                    this.print('', 'output');
                    return;
                }

                // Simple ls output
                this.print(items.join('  '), 'output');
            }

            changeDirectory(args) {
                const target = args[0] || '~';
                
                if (target === '~' || target === '/') {
                    this.currentDirectory = '~';
                    return;
                }

                if (target === '..') {
                    if (this.currentDirectory !== '~') {
                        this.currentDirectory = '~';
                    }
                    return;
                }

                const currentDir = this.getDirectory(this.currentDirectory);
                if (currentDir && currentDir.contents[target] && currentDir.contents[target].type === 'directory') {
                    this.currentDirectory = this.currentDirectory === '~' ? target : `${this.currentDirectory}/${target}`;
                } else {
                    this.print(`cd: ${target}: No such file or directory`, 'error');
                }
            }

            catFile(args) {
                const filename = args[0];
                if (!filename) {
                    this.print('cat: missing file operand', 'error');
                    return;
                }

                const currentDir = this.getDirectory(this.currentDirectory);
                if (currentDir && currentDir.contents[filename] && currentDir.contents[filename].type === 'file') {
                    this.print(currentDir.contents[filename].content, 'output');
                } else {
                    this.print(`cat: ${filename}: No such file or directory`, 'error');
                }
            }

            makeDirectory(args) {
                const dirname = args[0];
                if (!dirname) {
                    this.print('mkdir: missing operand', 'error');
                    return;
                }

                const currentDir = this.getDirectory(this.currentDirectory);
                if (currentDir) {
                    if (currentDir.contents[dirname]) {
                        this.print(`mkdir: ${dirname}: File exists`, 'error');
                    } else {
                        currentDir.contents[dirname] = { type: 'directory', contents: {} };
                    }
                }
            }

            touchFile(args) {
                const filename = args[0];
                if (!filename) {
                    this.print('touch: missing file operand', 'error');
                    return;
                }

                const currentDir = this.getDirectory(this.currentDirectory);
                if (currentDir) {
                    if (currentDir.contents[filename]) {
                        // Update timestamp (in real implementation)
                    } else {
                        currentDir.contents[filename] = { type: 'file', content: '' };
                    }
                }
            }

            removeFile(args) {
                const filename = args[0];
                if (!filename) {
                    this.print('rm: missing operand', 'error');
                    return;
                }

                const currentDir = this.getDirectory(this.currentDirectory);
                if (currentDir && currentDir.contents[filename]) {
                    delete currentDir.contents[filename];
                } else {
                    this.print(`rm: ${filename}: No such file or directory`, 'error');
                }
            }

            getDirectory(path) {
                if (path === '~') {
                    return this.fileSystem['~'];
                }
                // For simplicity, we'll only handle the root directory for now
                return this.fileSystem['~'];
            }

            navigateHistory(direction) {
                if (direction === 'up' && this.historyIndex > 0) {
                    this.historyIndex--;
                    this.commandInput.textContent = this.commandHistory[this.historyIndex];
                } else if (direction === 'down' && this.historyIndex < this.commandHistory.length - 1) {
                    this.historyIndex++;
                    this.commandInput.textContent = this.commandHistory[this.historyIndex];
                } else if (direction === 'down' && this.historyIndex === this.commandHistory.length - 1) {
                    this.historyIndex++;
                    this.commandInput.textContent = '';
                }
                
                // Move cursor to end
                this.moveCursorToEnd();
            }

            handleTabCompletion() {
                // Simple tab completion for common commands
                const input = this.commandInput.textContent.toLowerCase();
                const commands = ['ls', 'pwd', 'cd', 'mkdir', 'rm', 'cat', 'echo', 'date', 'whoami', 'clear', 'help', 'history', 'exit', 'touch', 'neofetch'];
                
                for (let cmd of commands) {
                    if (cmd.startsWith(input)) {
                        this.commandInput.textContent = cmd;
                        this.moveCursorToEnd();
                        break;
                    }
                }
            }

            moveCursorToEnd() {
                const range = document.createRange();
                const selection = window.getSelection();
                range.selectNodeContents(this.commandInput);
                range.collapse(false);
                selection.removeAllRanges();
                selection.addRange(range);
            }

            print(text, type = 'output') {
                const line = document.createElement('div');
                line.className = `command-${type}`;
                line.textContent = text;
                this.terminalContent.appendChild(line);
                this.scrollToBottom();
            }

            createNewLine() {
                const line = document.createElement('div');
                line.className = 'terminal-line';
                
                const prompt = document.createElement('span');
                prompt.className = 'prompt';
                prompt.textContent = this.updatePrompt();
                
                const input = document.createElement('span');
                input.className = 'command-input';
                input.contentEditable = true;
                input.id = 'commandInput';
                
                line.appendChild(prompt);
                line.appendChild(input);
                this.terminalContent.appendChild(line);
                
                // Update reference and focus
                this.commandInput = input;
                this.commandInput.focus();
                
                // Add event listeners to new input
                this.commandInput.addEventListener('keydown', (e) => this.handleKeyDown(e));
                this.commandInput.addEventListener('input', (e) => this.handleInput(e));
                
                this.scrollToBottom();
            }

            clear() {
                this.terminalContent.innerHTML = '';
                this.createNewLine();
            }

            scrollToBottom() {
                this.terminalContent.scrollTop = this.terminalContent.scrollHeight;
            }
        }

        // Initialize terminal when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new Terminal();
        });

        // Terminal window controls + drag + resize
        document.addEventListener('DOMContentLoaded', () => {
            const terminalWindow = document.getElementById('terminalWindow');
            const terminalHeader = document.querySelector('.terminal-header');

            // Dragging
            let isDragging = false;
            let dragOffsetX = 0;
            let dragOffsetY = 0;

            terminalHeader.addEventListener('mousedown', (e) => {
                if (e.target.closest('.terminal-buttons')) return; // Don't drag from buttons
                isDragging = true;
                const rect = terminalWindow.getBoundingClientRect();
                dragOffsetX = e.clientX - rect.left;
                dragOffsetY = e.clientY - rect.top;
                document.body.style.userSelect = 'none';
            });
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    let x = e.clientX - dragOffsetX;
                    let y = e.clientY - dragOffsetY;
                    // Keep within viewport
                    x = Math.max(0, Math.min(window.innerWidth - terminalWindow.offsetWidth, x));
                    y = Math.max(0, Math.min(window.innerHeight - terminalWindow.offsetHeight, y));
                    terminalWindow.style.left = x + 'px';
                    terminalWindow.style.top = y + 'px';
                    terminalWindow.style.transform = '';
                }
            });
            document.addEventListener('mouseup', () => {
                isDragging = false;
                document.body.style.userSelect = '';
            });

            // Edge/corner resizing
            let isResizing = false;
            let resizeDir = '';
            let resizeStartX = 0;
            let resizeStartY = 0;
            let startWidth = 0;
            let startHeight = 0;
            let startLeft = 0;
            let startTop = 0;
            const edgeSize = 8; // px

            function getResizeDir(e) {
                const rect = terminalWindow.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                let dir = '';
                if (y < edgeSize) dir += 'n';
                else if (y > rect.height - edgeSize) dir += 's';
                if (x < edgeSize) dir += 'w';
                else if (x > rect.width - edgeSize) dir += 'e';
                return dir;
            }

            terminalWindow.addEventListener('mousemove', (e) => {
                if (isResizing) return;
                const dir = getResizeDir(e);
                terminalWindow.classList.remove(
                    'resizing-n','resizing-s','resizing-e','resizing-w','resizing-ne','resizing-nw','resizing-se','resizing-sw'
                );
                if (dir) terminalWindow.classList.add('resizing-' + dir);
            });
            terminalWindow.addEventListener('mouseleave', () => {
                if (!isResizing) {
                    terminalWindow.classList.remove(
                        'resizing-n','resizing-s','resizing-e','resizing-w','resizing-ne','resizing-nw','resizing-se','resizing-sw'
                    );
                }
            });
            terminalWindow.addEventListener('mousedown', (e) => {
                const dir = getResizeDir(e);
                if (!dir) return;
                isResizing = true;
                resizeDir = dir;
                resizeStartX = e.clientX;
                resizeStartY = e.clientY;
                const rect = terminalWindow.getBoundingClientRect();
                startWidth = rect.width;
                startHeight = rect.height;
                startLeft = rect.left;
                startTop = rect.top;
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });
            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                let dx = e.clientX - resizeStartX;
                let dy = e.clientY - resizeStartY;
                let newWidth = startWidth;
                let newHeight = startHeight;
                let newLeft = startLeft;
                let newTop = startTop;
                if (resizeDir.includes('e')) newWidth = Math.max(350, startWidth + dx);
                if (resizeDir.includes('s')) newHeight = Math.max(200, startHeight + dy);
                if (resizeDir.includes('w')) {
                    newWidth = Math.max(350, startWidth - dx);
                    newLeft = startLeft + dx;
                }
                if (resizeDir.includes('n')) {
                    newHeight = Math.max(200, startHeight - dy);
                    newTop = startTop + dy;
                }
                terminalWindow.style.width = newWidth + 'px';
                terminalWindow.style.height = newHeight + 'px';
                if (resizeDir.includes('w') || resizeDir.includes('n')) {
                    terminalWindow.style.left = newLeft + 'px';
                    terminalWindow.style.top = newTop + 'px';
                    terminalWindow.style.transform = '';
                }
            });
            document.addEventListener('mouseup', () => {
                isResizing = false;
                resizeDir = '';
                document.body.style.userSelect = '';
                terminalWindow.classList.remove(
                    'resizing-n','resizing-s','resizing-e','resizing-w','resizing-ne','resizing-nw','resizing-se','resizing-sw'
                );
            });
        });

        // Finder dropdown menu JS
        document.addEventListener('DOMContentLoaded', () => {
            const finderBtn = document.getElementById('finderMenuBtn');
            const finderDropdown = document.getElementById('finderDropdown');
            
            finderBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                finderBtn.classList.toggle('open');
            });
            document.addEventListener('click', (e) => {
                finderBtn.classList.remove('open');
            });
            finderDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        });

        // Live date/time for menu bar
        function updateMenuDate() {
            const el = document.getElementById('menuDate');
            const now = new Date();
            const options = { weekday: 'short', month: 'short', day: 'numeric' };
            const dateStr = now.toLocaleDateString(undefined, options);
            const timeStr = now.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
            el.textContent = `${dateStr}  ${timeStr}`;
        }
        setInterval(updateMenuDate, 1000);
        updateMenuDate();

        // Apple menu dropdown JS
        document.addEventListener('DOMContentLoaded', () => {
            const appleBtn = document.getElementById('appleMenuBtn');
            const appleDropdown = document.getElementById('appleDropdown');
            const restartMenu = document.getElementById('restartMenu');
            
            appleBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                appleBtn.classList.toggle('open');
            });
            document.addEventListener('click', (e) => {
                appleBtn.classList.remove('open');
            });
            appleDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
            function doRestart(e) {
                e.stopPropagation();
                console.log('Restart triggered');
                location.reload();
            }
            if (restartMenu) {
                restartMenu.addEventListener('mousedown', doRestart);
                restartMenu.addEventListener('click', doRestart);
                restartMenu.addEventListener('mouseup', doRestart);
            }
        });

        // App window creation logic
        function createAppWindow(title = 'Sample App', content = 'This is a sample desktop app window.') {
            const appWindows = document.getElementById('appWindows');
            const win = document.createElement('div');
            win.className = 'app-window';
            win.style.top = (120 + Math.random() * 100) + 'px';
            win.style.left = (120 + Math.random() * 100) + 'px';
            win.innerHTML = `
                <div class="app-window-header">
                    <div class="app-window-title">${title}</div>
                    <button class="app-window-close"></button>
                </div>
                <div class="app-window-content">${content}</div>
            `;
            appWindows.appendChild(win);
            // Close button
            win.querySelector('.app-window-close').onclick = () => win.remove();
            // Dragging
            const header = win.querySelector('.app-window-header');
            let isDragging = false, offsetX = 0, offsetY = 0;
            header.addEventListener('mousedown', (e) => {
                isDragging = true;
                const rect = win.getBoundingClientRect();
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;
                document.body.style.userSelect = 'none';
            });
            document.addEventListener('mousemove', dragMove);
            document.addEventListener('mouseup', dragEnd);
            function dragMove(e) {
                if (!isDragging) return;
                let x = e.clientX - offsetX;
                let y = e.clientY - offsetY;
                // Keep within viewport
                x = Math.max(0, Math.min(window.innerWidth - win.offsetWidth, x));
                y = Math.max(0, Math.min(window.innerHeight - win.offsetHeight, y));
                win.style.left = x + 'px';
                win.style.top = y + 'px';
            }
            function dragEnd() {
                isDragging = false;
                document.body.style.userSelect = '';
            }
        }
    </script>
</body>
</html> 